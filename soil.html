<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>åœŸå£Œè¨ºæ–­çµæœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; line-height: 1.7; padding: 16px; max-width: 800px; margin: 0 auto; }
    .badge {
      display: inline-block;
      color: white;
      padding: 4px 12px;
      border-radius: 4px;
      margin-right: 6px;
      font-weight: bold;
      font-size: 14px;
    }
    .stars { color: #ff9800; }
    details { margin-top: 12px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
    canvas { max-width: 100%; margin: 20px auto; display: block; }
  </style>
</head>
<body>
  <h1 id="fieldName"></h1>
  <p id="location"></p>
  
  <div>
    <span class="badge" id="rank"></span>
    <span class="badge" style="background:#4caf50;">åœŸå£Œè¨ºæ–­æ¸ˆã¿</span>
  </div>

  <p id="oneLine" style="font-weight:bold; margin-top:1em;"></p>

  <h2>ğŸŒ± ãƒ–ãƒ©ãƒ³ãƒ‰è©•ä¾¡</h2>
  <canvas id="radarChart" width="400" height="400"></canvas>
  
  <ul>
    <li>ğŸš ãŠã„ã—ã•ï¼š<span class="stars" id="taste"></span></li>
    <li>ğŸŒ± åœŸå£Œã®å¥å…¨æ€§ï¼š<span class="stars" id="soilHealth"></span></li>
    <li>ğŸŒ ç’°å¢ƒé…æ…®ï¼š<span class="stars" id="environment"></span></li>
    <li>ğŸ›¡ å®‰å…¨æ€§ï¼š<span class="stars" id="safety"></span></li>
  </ul>

  <h2>ğŸ“– åœŸå£Œã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h2>
  <img id="storyImage" src="" style="max-width:100%; border-radius:8px; display:none; margin-bottom:10px;">
  <p id="story"></p>

  <details>
    <summary>ğŸ”¬ å°‚é–€ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹</summary>
    <ul id="analysis"></ul>
  </details>

  <h2>ğŸŒ¾ ã“ã®åœŸå£Œã§è‚²ã£ãŸãŠç±³</h2>
  <ul id="rice"></ul>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ãƒ©ãƒ³ã‚¯åˆ¥ã‚«ãƒ©ãƒ¼åˆ¤å®šé–¢æ•°
    function rankColor(rank, alpha = 1) {
      switch (rank) {
        case "A": return `rgba(76, 175, 80, ${alpha})`;   // ç·‘
        case "B": return `rgba(255, 193, 7, ${alpha})`;   // é»„
        case "C": return `rgba(244, 67, 54, ${alpha})`;   // èµ¤
        default:  return `rgba(158, 158, 158, ${alpha})`; // ã‚°ãƒ¬ãƒ¼
      }
    }

    const params = new URLSearchParams(location.search);
    const soilId = params.get("id");

    Promise.all([
      fetch("soil.json").then(res => res.json()),
      fetch("rice.json").then(res => res.json())
    ]).then(([soils, riceList]) => {
      const soil = soils.find(s => s.soil_id === soilId);
      if (!soil) return;

      // ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã®åŸ‹ã‚è¾¼ã¿
      document.getElementById("fieldName").textContent = soil.name;
      document.getElementById("location").textContent = soil.location;
      document.getElementById("oneLine").textContent = soil.one_line;
      document.getElementById("story").textContent = soil.story;
      // â–¼ è¿½åŠ ï¼šå†™çœŸãŒã‚ã‚Œã°è¡¨ç¤ºã™ã‚‹å‡¦ç†
      const storyImg = document.getElementById("storyImage");
      if (soil.story_image) {
        storyImg.src = soil.story_image;
        storyImg.style.display = "block"; // å†™çœŸãŒã‚ã‚‹æ™‚ã ã‘è¡¨ç¤º
      } else {
        storyImg.style.display = "none";
      }

      // ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ã®è‰²è¨­å®š
      const rankBadge = document.getElementById("rank");
      rankBadge.textContent = soil.rank + "ãƒ©ãƒ³ã‚¯";
      rankBadge.style.backgroundColor = rankColor(soil.rank);

      // æ˜Ÿè©•ä¾¡
      const star = n => "â˜…".repeat(n) + "â˜†".repeat(5 - n);
      document.getElementById("taste").textContent = star(soil.brand_scores.taste);
      document.getElementById("soilHealth").textContent = star(soil.brand_scores.soil_health);
      document.getElementById("environment").textContent = star(soil.brand_scores.environment);
      document.getElementById("safety").textContent = star(soil.brand_scores.safety);

      // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæç”»
      const ctx = document.getElementById("radarChart");
      const mainColor = rankColor(soil.rank, 1);
      const fillColor = rankColor(soil.rank, 0.25);

      new Chart(ctx, {
        type: "radar",
        data: {
          labels: ["ãŠã„ã—ã•", "åœŸå£Œã®å¥å…¨æ€§", "ç’°å¢ƒé…æ…®", "å®‰å…¨æ€§"],
          datasets: [{
            label: "åœŸå£Œè¨ºæ–­è©•ä¾¡",
            data: [
              soil.brand_scores.taste,
              soil.brand_scores.soil_health,
              soil.brand_scores.environment,
              soil.brand_scores.safety
            ],
            fill: true,
            backgroundColor: fillColor,
            borderColor: mainColor,
            pointBackgroundColor: mainColor
          }]
        },
        options: {
          scales: {
            r: {
              min: 0,
              max: 5,
              ticks: { display: false, stepSize: 1 },
              pointLabels: { font: { size: 14 } }
            }
          },
          plugins: { legend: { display: false } }
        }
      });

      // å°‚é–€ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ
      const analysis = document.getElementById("analysis");
      Object.entries(soil.analysis).forEach(([k, v]) => {
        const li = document.createElement("li");
        li.textContent = `${k}ï¼š${v}`;
        analysis.appendChild(li);
      });

      // ãŠç±³æƒ…å ±
      const rice = riceList.find(r => r.product_id === soil.linked_rice);
      if (rice) {
        const ul = document.getElementById("rice");
        rice.taste.forEach(t => {
          const li = document.createElement("li");
          li.textContent = t;
          ul.appendChild(li);
        });
      }
    });
  </script>
</body>
</html>